package esch

import (
    "fmt"
    "testing"
    "encoding/hex"

    "github.com/deatil/go-hash/hash"
)

func fromHex(s string) []byte {
    h, _ := hex.DecodeString(s)
    return h
}

func Test_Name256(t *testing.T) {
    if ESCH256.String() != "ESCH256" {
        t.Error("ESCH256 name fail")
    }
}

var testDatas = []struct {
    output string
    input  string
}{
    {"12e076105e60fd4080ca7546340e180aaa4c277c1495e958df869ceaf0843f2e", "00010203040506"},
    {"47ffaee11bfec90e49ef4671c25867123d8e24392b13a9c265c7970f33c16785", "000102030405060708090A"},
    {"2efd300525b3a4fe87933334e2c87affefb65b4f59bd72c2af3f7a69740d0d15", "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF"},
}

func Test_SumBy256(t *testing.T) {
    for index, test := range testDatas {
        e := hash.
            FromBytes(fromHex(test.input)).
            SumBy(ESCH256)

        t.Run(fmt.Sprintf("SumBy %d", index), func(t *testing.T) {
            if e.Error != nil {
                t.Fatal(e.Error)
            }

            if e.ToHexString() != test.output {
                t.Errorf("got %s, want %s", e.ToHexString(), test.output)
            }
        })
    }
}

func Test_NewBy256(t *testing.T) {
    for index, test := range testDatas {
        e := hash.
            Hashing().
            NewBy(ESCH256).
            Write(fromHex(test.input)).
            Sum(nil)

        t.Run(fmt.Sprintf("NewBy %d", index), func(t *testing.T) {
            if e.Error != nil {
                t.Fatal(e.Error)
            }

            if e.ToHexString() != test.output {
                t.Errorf("got %s, want %s", e.ToHexString(), test.output)
            }
        })
    }
}
